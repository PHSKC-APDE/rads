% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc.R, R/calc.data.table.R, R/calc.tbl_svy.R,
%   R/survey_tabulate.R
\name{calc}
\alias{calc}
\alias{calc.data.table}
\alias{calc.tbl_svy}
\title{Compute metrics from record (e.g. vital stats) or survey data}
\usage{
calc(ph.data, ...)

\method{calc}{data.table}(
  ph.data,
  what,
  ...,
  by = NULL,
  metrics = c("mean", "numerator", "denominator", "missing", "total"),
  per = NULL,
  win = NULL,
  time_var = "chi_year",
  proportion = FALSE
)

\method{calc}{tbl_svy}(
  ph.data,
  what,
  ...,
  by = NULL,
  metrics = c("mean", "numerator", "denominator", "missing", "total"),
  per = NULL,
  win = NULL,
  time_var = "chi_year",
  proportion = FALSE
)

\method{calc}{tbl_svy}(
  ph.data,
  what,
  ...,
  by = NULL,
  metrics = c("mean", "numerator", "denominator", "missing", "total"),
  per = NULL,
  win = NULL,
  time_var = "chi_year",
  proportion = FALSE
)
}
\arguments{
\item{ph.data}{data.table or tbl_svy. Dataset.}

\item{...}{expressions to be passed to \code{\link{filter}} (or equivalent)}

\item{what}{character vector. Variable to calculate metrics for.}

\item{by}{character vector. Must refer to variables within ph.data. The variables within ph.data to compute `what` by}

\item{metrics}{character. See \code{\link{record_metrics}} for the available options. Note, except when 'distinct' is
selected, all metrics are calculated -- this argument just specifies which one gets returned}

\item{per}{integer. The denominator when "rate" or "adjusted-rate" are selected as the metric. Metrics will be multiplied by this value.}

\item{win}{integer. The number of consectutive units of time (e.g., years, months, etc.) over which the metrics will be calculated,
i.e., the 'window' for a rolling average, sum, etc.}

\item{time_var}{character. The name of the time variable in the dataset. Typically this is the year variable, i.e., "chi_year"}

\item{proportion}{logical. For survey data, should metrics be calculated assuming the output is proportion-like? See details for more.
Currently does not have functionality for non-survey data.}
}
\value{
a data.table containing the results
}
\description{
Compute metrics from record (e.g. vital stats) or survey data
}
\details{
This function calculates `metrics` for each variable in `what` from rows meeting the conditions specified
by `...` (i.e., where), for each grouping implied by `by`.

For survey data, use the \code{proportion} argument where relevant to ensure metrics are calculated using special proportion (e.g \code{svyciprop})
methods. That is, when you want to find the fraction of ____, toggle \code{proportion} to \code{TRUE}.
}
\examples{

#record data
test.data <- get_data_birth(year = 2015:2017)

test.results <- calc(test.data,
                     what = c("kotelchuck", "fetal_pres"),
                     "chi_year == 2016 & chi_sex \%in\% c('Male', 'Female')",
                      by = c("chi_year", "chi_sex"),
                      metrics = c("mean", "numerator", "denominator",
                                  "total", "lower", "upper", "se"))

}
