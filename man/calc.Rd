% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc.R, R/calc.dtsurvey.R
\name{calc}
\alias{calc}
\alias{calc.dtsurvey}
\title{Compute metrics from record (e.g. vital stats) or survey data}
\usage{
calc(ph.data, ...)

\method{calc}{dtsurvey}(
  ph.data,
  what,
  where,
  by = NULL,
  metrics = c("mean", "numerator", "denominator"),
  per = NULL,
  win = NULL,
  time_var = NULL,
  proportion = FALSE,
  fancy_time = TRUE,
  ci = 0.95,
  verbose = FALSE,
  ...
)
}
\arguments{
\item{ph.data}{data.table or tbl_svy. Dataset.}

\item{...}{not implemented}

\item{what}{character vector. Variable to calculate metrics for.}

\item{where}{subsetting expression}

\item{by}{character vector. Must refer to variables within ph.data. The variables within ph.data to compute \code{what} by}

\item{metrics}{character. See \code{\link{metrics}} or scroll below for the available options.}

\item{per}{integer. The denominator when "rate" or "adjusted-rate" are selected as the metric. Metrics will be multiplied by this value.}

\item{win}{integer. The number of consecutive units of time (e.g., years, months, etc.) over which the metrics will be calculated,
i.e., the 'window' for a rolling average, sum, etc.}

\item{time_var}{character. The name of the time variable in the dataset. Used in combination with the "win" argument to do time windowed calculations.}

\item{proportion}{logical. For survey data, should metrics be calculated assuming the output is proportion-like? See details for more.
Currently does not have functionality for non-survey data.}

\item{fancy_time}{logical. If TRUE, a record of all the years going into the data is provided.
If FALSE, just a simple range (where certain years within the range might not be represented in your data).}

\item{ci}{numeric. Confidence level, >0 & <1, typically 0.95}

\item{verbose}{logical. Mostly unused, but toggles on/off printed warnings.}
}
\value{
a data.table containing the results
}
\description{
Compute metrics from record (e.g. vital stats) or survey data
}
\details{
This function calculates \code{metrics} for each variable in \code{what} from rows meeting the conditions specified
by \code{where} for each grouping implied by \code{by}.

Available metrics include:
\enumerate{
\item total: Count of people with the given value. Mostly relevant for surveys
(where total is approximately mean * sum(pweights)).
Returns total, total_se, total_upper, total_lower.
total_se, total_upper, & total_lower are only valid for survey data.
Default ci (e.g. upper and lower) is 95 percent.
\item mean: Average response and associated metrics of uncertainty.
Returns mean, mean_se, mean_lower, mean_upper.
Default ci (e.g. upper and lower) is 95 percent.
\item rse: Relative standard error. 100*se/mean.
\item numerator: Sum of non-NA values for `what``.
The numerator is always unweighted.
\item denominator: Number of rows where \code{what} is not NA.
The denominator is always unweighted.
\item obs: Number of unique observations (i.e., rows), agnostic as to whether
there is missing data for \code{what}. The obs is always unweighted.
\item median: The median non NA response. Not populated when \code{what} is a factor
or character. Even for surveys, the median is the unweighted result.
\item unique.time: Number of unique time points (from \code{time_var}) included in
each tabulation (i.e., number of unique time points when the \code{what} is not missing).
\item missing: Number of rows in a given grouping with an NA value for \code{what}.
missing + denominator = Number of people in a given group.
When \code{what} is a factor/character, the missing information is provided for the other.
\item missing.prop: The proportion of the data that has an NA value for \code{what}.
\item rate: mean * per. Provides rescaled mean estimates (i.e., per 100 or per 100,0000).
Returns rate, rate_se, rate_lower, rate_upper.
Default ci (e.g. upper and lower) is 95 percent.
}

For survey data, use the \code{proportion} argument where relevant to ensure metrics are calculated using special proportion (e.g \code{svyciprop})
methods. That is, when you want to find the fraction of ____, toggle \code{proportion} to \code{TRUE}.
}
\examples{

#record data
test.data <- get_data_birth(year = 2015:2017)

test.results <- calc(test.data,
                     what = c("kotelchuck", "fetal_pres"),
                     chi_year == 2016 & chi_sex \%in\% c('Male', 'Female'),
                      by = c("chi_year", "chi_sex"),
                      metrics = c("mean", "numerator", "denominator",
                                  "total"))

}
\references{
\url{https://github.com/PHSKC-APDE/rads/wiki/calc}
}
