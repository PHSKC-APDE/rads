% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/age_standardize.R
\name{age_standardize}
\alias{age_standardize}
\title{Calculate age standardized rates from a data.table with age, counts, and population columns}
\usage{
age_standardize(
  ph.data,
  ref.popname = NULL,
  collapse = TRUE,
  my.count = "count",
  my.pop = "pop",
  per = 1e+05,
  conf.level = 0.95,
  group_by = NULL,
  diagnostic_report = FALSE,
  event_type = "unique"
)
}
\arguments{
\item{ph.data}{a data.table or data.frame containing the data to be age-standardized.}

\item{ref.popname}{Character vector of length 1. Only valid options are those
in \code{\link[=list_ref_pop]{list_ref_pop()}} and \code{"none"} (when standard population already exists in ph.data)}

\item{collapse}{Logical vector of length 1. Do you want to collapse ph.data ages
to match those in \code{ref.popname}?}

\item{my.count}{Character vector of length 1. Identifies the column with the
count data aggregated by the given demographics.}

\item{my.pop}{Character vector of length 1. Identifies the column with the
population corresponding to the given demographics.}

\item{per}{Integer vector of length 1. A multiplier for all rates and CI, e.g.,
when per = 1000, the rates are per 1000 people}

\item{conf.level}{A numeric vector of length 1. The confidence interval used
in the calculations, >0 & <1, typically 0.95}

\item{group_by}{Character vector of indeterminate length. By which variable(s)
do you want to stratify the rate results, if any?}

\item{diagnostic_report}{Logical vector of length 1. If \code{group_by} is used and
there are groups with missing ages, setting \code{diagnostic_report = TRUE} returns
a diagnostic table instead of normal results. Use this option if a warning about
missing age groups appears when running the function normally.}

\item{event_type}{Character vector of length 1. Either \code{"unique"} (default) for
events that can only occur once per person (e.g., death, first diagnosis), or
\code{"repeatable"} for events that can occur multiple times per person (e.g., ER visits, infections).
When \code{"unique"}, rates are capped at 100\%; when "repeatable", rates can exceed 100\%.}
}
\value{
A data.table of the count, rate & adjusted rate with CIs, name of the reference population and the 'group_by' variable(s) -- if any
}
\description{
Calculate age standardized rates from a data.table with age, counts, and population columns.
}
\details{
\code{ph.data} must have the following three columns:
\itemize{
\item 'age' or 'agecat': 'age' in single years (if collapse = TRUE) or 'agecat'
with the same age bins as your selected reference population (if collapse = FALSE)
\item \code{my.count}: an \emph{aggregated} count for the event (e.g., disease) for which you
want to find an age standardized rate
\item \code{my.pop}: the population corresponding to the age or agecat
}

When analyzing \emph{specific age subsets} (e.g., adolescents, seniors, etc.), include \emph{only} those ages.

When analyzing the \emph{whole population}, \emph{include all ages} with zero counts where no
events occurred to ensure accurate age-standardized rates.
}
\section{Note on Standard Errors}{

This function calculates confidence intervals using the
\href{https://wonder.cdc.gov/controller/pdf/FayFeuerConfidenceIntervals.pdf}{Fay-Feuer method},
which does not provide direct standard error (SE) estimates. If you need SE approximations,
common methods used by health departments include \code{SE = adjusted_rate/sqrt(cases)} and
\code{RSE = 1/sqrt(cases)}.
}

\section{Data anomalies}{

When the aggregate event count (\code{count}) is greater than the corresponding
aggregate population (\code{pop}) AND\code{event_type = "unique"}, the function issues
a warning and internally adjusts the denominator in the \code{\link[=adjust_direct]{adjust_direct()}}
function to cap rates at 100\%. When \code{count > pop} AND \code{event_type = "repeatable"},
no adjustment is made as rates can legitimately exceed 100\%.

If the population is zero, the function always makes a small adjustment to allow
rate calculation. These adjustments ensure stable results and only minimally bias
estimates, since such anomalies usually occur in small strata.
}

\examples{
\donttest{
library(data.table)
temp1 <- data.table(age = c(50:60), count = c(25:35), pop = c(seq(1000, 900, -10)) )
age_standardize(ph.data = temp1,
ref.popname = "2000 U.S. Std Population (18 age groups - Census P25-1130)",
collapse = TRUE,
my.count = "count",
my.pop = "pop",
per = 1000,
conf.level = 0.95)[]

temp2 <- data.table(sex = c(rep("M", 11), rep("F", 11)), age = rep(50:60, 2),
count = c(25:35, 26:36), pop = c(seq(1000, 900, -10), seq(1100, 1000, -10)),
stdpop = rep(1000, 22))
age_standardize(ph.data = temp2, ref.popname = "none",
collapse = FALSE,
my.count = "count",
my.pop = "pop",
per = 1000,
conf.level = 0.95,
group_by = "sex")[]
}
}
\references{
\url{https://github.com/PHSKC-APDE/rads/wiki/age_standardize}
}
\seealso{
\code{\link[=adjust_direct]{adjust_direct()}} for calculating crude and directly adjusted rates.
}
