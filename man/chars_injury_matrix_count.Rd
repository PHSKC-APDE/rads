% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/chars_functions.R
\name{chars_injury_matrix_count}
\alias{chars_injury_matrix_count}
\title{Generate injury matrix counts from line-level Comprehensive Hospital
Abstract Reporting System (CHARS) data}
\usage{
chars_injury_matrix_count(
  ph.data = NULL,
  intent = "*",
  mechanism = "*",
  group_by = NULL,
  def = "narrow",
  primary_ecode = TRUE,
  kingco = TRUE
)
}
\arguments{
\item{ph.data}{a data.table or data.frame. Must contain CHARS data structured
with one patient record per row. It must have the following columns, as
specified by \code{\link[=chars_validate_data]{chars_validate_data()}}: \code{seq_no}, \code{injury_nature_broad},
\code{injury_nature_narrow}, \code{injury_intent}, and \code{injury_mechanism}. See
\code{rads.data::synthetic_chars()} for a fully formatted example. If you are
working within the King County, WA infrastructure, you can get formatted data
from \code{apde.data::chars()}.

The default is \code{ph.data = NULL}}

\item{intent}{a character vector. It specifies the intent of the injury
related hospitalization that you want returned (e.g., "assault",
"intentional", "unintentional", etc.). "none" will ignore the intent and only
return the mechanism of the injury leading to hospitalization.

\strong{NOTE}
You do not have to type the entire keyword for the intent, a
partial string match is sufficient and is case insensitive. E.g.,
\code{intent = c("intent")} would return both "intentional" and "unintentional" and
\code{intent = c("un")} would return both "undetermined" and "unintentional".

The default is \code{intent = '*'}, which selects all possible intents}

\item{mechanism}{a character vector. It specifies the mechanism of the injury
related hospitalization that you want returned (e.g., "cut_pierce",
"drowning", "fall", "firearm", etc.). "none" will ignore the mechanism and
only return the intent of the injury leading to hospitalization.

To see the complete list of mechanisms, type
\code{unique(chars_injury_matrix()$mechanism)} in your R console.

\strong{NOTE}
You do not have to type the entire keyword for the mechanism, a
partial string match is sufficient and is case insensitive. E.g.,
\code{mechanism = c("fire")} would return both "firearm" and
"fire_burn".

\strong{SPECIAL CASE: motor_vehicle_traffic}

The mechanism "motor_vehicle_traffic" is a convenience aggregation that combines
all motor vehicle traffic-related subcategories: "mvt_occupant", "mvt_motorcyclist",
"mvt_pedestrian", "mvt_pedal_cyclist", etc. When you specify
\code{mechanism = "motor_vehicle_traffic"}, the function will count
hospitalizations for any of these MVT subcategories.

The default is \code{mechanism = '*'}, which selects all possible mechanisms}

\item{group_by}{a character vector of indeterminate length. This is used to
specify all the variables by which you want to group (a.k.a. stratify) the
results. For example, if you specified \code{group_by = c('chi_sex', 'race3')}, the results would be stratified by each combination of sex
and race.

The default is \code{group_by = NULL}}

\item{def}{a character vector of length one, limited to 'narrow' or 'broad'.
It specifies whether you want to use the CDC's recommended 'narrow' approach,
which requires that the \strong{principal diagnosis} of an injury
hospitalization be a nature-of-injury ICD10-CM code. Or, alternatively, the
'broad' definition that searches all available diagnosis fields on the
hospital discharge record (there can be a maximum of 54 diagnosis fields in
CHARS data).

\strong{NOTE}
ph.data must contain the columns named \code{injury_nature_narrow} &
\code{injury_nature_broad}.

The default is \code{def = 'narrow'}}

\item{primary_ecode}{a logical vector of length one. It specifies whether you
want to limit the analysis to using just the primary ecode (i.e., the
\code{injury_ecode} variable), rather than all available ecodes.

As of RADS 1.1.7.7, the only valid argument is TRUE (T). Those wanting to perform
an analysis with other ecodes would need to perform a custom analysis in SQL using
the \code{chars.stage_diag} & \code{chars.stage_ecode} tables.

The default is \code{primary_ecode = TRUE}}

\item{kingco}{a logical vector of length one. It specifies whether you want to
limit the analysis to King County. This parameter is specific to Washington State
CHARS data and requires the column \code{chi_geo_kc}, which is provided by
\code{\link[apde.data:chars]{apde.data::chars()}}.

For users outside of King County or Washington State, set \code{kingco = FALSE}.

The default is \code{kingco = TRUE}}
}
\value{
The function returns a data.table with a minimum of three columns:
\code{mechanism}, \code{intent}, & \code{hospitalizations}. Any
\code{group_by} variables would also have their own columns.

The function default is to return the matrix of all intents and mechanisms
of injury related hospitalizations. You can choose to only return the intent
or only return the mechanism. If you set both to "none", you will receive a
summary of all injury hospitalizations without regard to the intent or mechanism.
}
\description{
Generate hospitalization counts for an injury matrix
specifying the intent and mechanism of injury. Needs line-level CHARS data.
Covers both ICD9-cm (2012-2015) and ICD10-cm (2016+).
}
\details{
Since the injury analysis uses many columns, we suggest that you obtain
ph.data with \code{apde.data::chars(cols = NA)}, rather than trying to specify the
columns of interest.

This function will only count injuries where the type of injury (from
ICD10-CM codes) AND the corresponding external cause information (from an
ecode) is present. The function uses the \code{injury_mechanism} and \code{injury_intent}
columns which contain the primary (first-listed) external cause for each hospitalization.
To examine injuries that do not have an external cause,
please examine the analytic data directly.

See Jeremy Whitehurst's documentation for the CHARS ETL to understand exactly
which codes are mapped to which intents and mechanisms.
}
\examples{
\donttest{
myresult <- chars_injury_matrix_count(ph.data = rads.data::synthetic_chars,
                                      intent = '^intentional',
                                      mechanism = 'none',
                                      group_by = c('temperament'),
                                      kingco = FALSE)
print(myresult)

myresult <- chars_injury_matrix_count(ph.data = rads.data::synthetic_chars,
                                      intent = 'unintentional',
                                      mechanism = 'fall',
                                      group_by = c('temperament'),
                                      kingco = FALSE)
print(myresult)
}

}
\references{
\itemize{
\item WA DOH Community Health Assessment Tool > User Guides > Code Set Definitions >
Hospitalization Injury Matrix ICD10CM
\item CDC Injury Code and Matrices: \url{https://www.cdc.gov/nchs/injury/injury_matrices.htm}
}
}
