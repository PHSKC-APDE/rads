<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Analyzing HYS data in rads</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Analyzing HYS data in rads</h1>



<p>The Healthy Youth Survey (HYS) is adminstered to WA state public school 6th, 8th, and 12th (and somethings 9th and 11th) grade students. It asks questions about sex, drugs, mental health, demographics and a series of other fun things. This vignette is designed to provid and overview of how to analyze HYS data using the <code>rads</code> package.</p>
<p>To begin, we load the rads package. Because it is dangerous to go at it alone, the rads package relies on a number of other packages to work its barely functional magic. For survey analysis, rads relies on the <code>srvyr</code>, <code>data.table</code>, and <code>dplyr</code> packages for survey statistics, data munging, and horrific quasiquotation programming respectively.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(<span class="st">&#39;data.table&#39;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(rads)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(<span class="st">&#39;srvyr&#39;</span>) <span class="co">#analyzing surveys</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(<span class="st">&#39;dplyr&#39;</span>) <span class="co">#data manipulation and stress</span></a></code></pre></div>
<p>Generally speaking, having a dataset is a necessary component of doing data analysis. <code>rads</code> regularly adds new datasets, and so provides a helper function to help users figure out which datasets are available. Note, the <code>rads::</code> is just there to highlight that we are executing a function from the <code>rads</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">rads<span class="op">::</span><span class="kw">list_apde_data</span>()</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#&gt; [1] &quot;hys&quot;   &quot;birth&quot; &quot;bsk&quot;</span></a></code></pre></div>
<p>Hark! The HYS dataset is available to load and analyze! What happy times! However, before we load the dataset, it might be worth checking what variables it contains. This can be useful if you only want to load a subset of the dataset for SPEED and MEMORY SAVING. You can do this like so:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">rads<span class="op">::</span><span class="kw">list_dataset_columns</span>(<span class="dt">dataset =</span> <span class="st">&#39;hys&#39;</span>, <span class="dt">analytic_only =</span> F)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt;   variable_name analytic_ready</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#&gt; 1               Sure. Why not?</span></a></code></pre></div>
<p>So the results are a bit disappointing, but this function will work better when the HYS dataset migrates to SQL. Anyways, we can imagine examining the list of columns to select which ones are best and are the most flattering. For now, we’ll just load the whole analytical dataset for 2016 and 2018.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">hys &lt;-<span class="st"> </span><span class="kw">get_data</span>(<span class="st">&#39;hys&#39;</span>, <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2016</span>, <span class="dv">2018</span>))</a></code></pre></div>
<p>It behooves us to examine what exactly we have loaded. A good place to start is by checking the <code>class</code>. We also check the dimensions (<code>dim(hys)</code>) for giggles.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&#39;The classes are: &#39;</span>, <span class="kw">paste</span>(<span class="kw">class</span>(hys), <span class="dt">collapse =</span> <span class="st">&#39;, &#39;</span>)))</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt; [1] &quot;The classes are: tbl_svy, survey.design2, survey.design, apde_hys&quot;</span></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">d =<span class="st"> </span><span class="kw">dim</span>(hys)</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;The dataset has&#39;</span>, d[<span class="dv">1</span>], <span class="st">&#39;respondents and&#39;</span>, d[<span class="dv">2</span>], <span class="st">&#39;columns loaded&#39;</span>))</a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; [1] &quot;The dataset has 117528 respondents and 368 columns loaded&quot;</span></a></code></pre></div>
<p>Some things to note from the results of the last codeblock.</p>
<ol style="list-style-type: decimal">
<li><p>The <code>hys</code> object is 4 classes– <code>tbl_svy</code> from the <code>srvyr</code> package, <code>survey.design2</code> and <code>survey.design1</code> from the underlying <code>survey</code> package, and <code>apde_hys</code> which the <code>rads</code> package appends to make some of the helper functions work. Classes are important because they help R figure out which functions and operations are proper to execute on a given object.</p></li>
<li><p>A <code>tbl_svy</code> is basically like a <code>tibble</code> from the <code>dplyr</code> package that is svyset (to borrow from stata vernacular). This means things like <code>filter</code>, <code>mutate</code>, <code>greoup_by</code> and other <code>dplyr</code> verbs will work on <code>tbl_svy</code> objects. The verb that is likely to be of the most interest is the <code>summarize</code> one. To properly compute survey weighted metrics, one must use functions in the form of <code>survey_mean</code> and what not. The <code>?summarize</code> page has a full listing.</p></li>
<li><p>While <code>dplyr</code> verbs will (sort of) work on the <code>hys</code> object, other mechanisms of data manipulation (e.g. base R or <code>data.table</code>) will not work without some modification. The way <code>tbl_svy</code> objects are structured means the underlying <code>data.frame</code>/<code>tibble</code> is stored in <code>hys$variables</code>. While you can alter this item outside the <code>dplyr</code> verb environment, it is not recommended because screwing with the variables that inform the survey design (e.g. psu, strata, and pweight) can make things go haywire. At some point the <code>rads</code> package might include the functionality to return just the raw data.frame so folks can svyset it themselves– but at the moment, I’m lazy.</p></li>
</ol>
<p>Presumably, if you, dear reader, have made it this far, you are anxious to start computing some health metrics. Hip. Hip. Hooray. Assuming you don’t need to do anything super fancy (e.g. you want a King County only number), you can do something like:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"></a>
<a class="sourceLine" id="cb6-2" title="2">res &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">tabulate_variable</span>(<span class="dt">variable =</span> <span class="st">&#39;ecig_vape&#39;</span>,</a>
<a class="sourceLine" id="cb6-4" title="4">                    <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;se&#39;</span>, <span class="st">&#39;numerator&#39;</span>, <span class="st">&#39;denominator&#39;</span>),</a>
<a class="sourceLine" id="cb6-5" title="5">                    <span class="dt">sex =</span> <span class="st">&#39;both&#39;</span>,</a>
<a class="sourceLine" id="cb6-6" title="6">                    <span class="dt">grade =</span> <span class="ot">NULL</span>, <span class="co">#all grades</span></a>
<a class="sourceLine" id="cb6-7" title="7">                    <span class="dt">region =</span> <span class="ot">NULL</span>, <span class="co">#all regions</span></a>
<a class="sourceLine" id="cb6-8" title="8">                    <span class="dt">race =</span> <span class="ot">NULL</span>, <span class="co">#a_race8,</span></a>
<a class="sourceLine" id="cb6-9" title="9">                    <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2016</span>, <span class="dv">2018</span>), <span class="co">#2016 and 2018 grouped</span></a>
<a class="sourceLine" id="cb6-10" title="10">                    <span class="dt">sexual_orientation =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb6-11" title="11">                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb6-12" title="12">                   )</a>
<a class="sourceLine" id="cb6-13" title="13"></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#fix some things for display</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#note, the output of tabulate_variable is a data.table</span></a>
<a class="sourceLine" id="cb6-16" title="16">res[, .Sexual_Orientation <span class="op">:</span><span class="er">=</span><span class="st"> &#39;All&#39;</span>]</a>
<a class="sourceLine" id="cb6-17" title="17">res[, .Race <span class="op">:</span><span class="er">=</span><span class="st"> &#39;All&#39;</span>]</a>
<a class="sourceLine" id="cb6-18" title="18">res[, .Region <span class="op">:</span><span class="er">=</span><span class="st"> &#39;King County&#39;</span>]</a>
<a class="sourceLine" id="cb6-19" title="19">res[, .Grade <span class="op">:</span><span class="er">=</span><span class="st"> &#39;All&#39;</span>]</a>
<a class="sourceLine" id="cb6-20" title="20">res[, .Year <span class="op">:</span><span class="er">=</span><span class="st"> &#39;2016 - 2018&#39;</span>]</a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">#Print the results</span></a>
<a class="sourceLine" id="cb6-23" title="23">res[]</a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">#&gt;    .Sex .Grade     .Region       .Year .Sexual_Orientation .Race      mean</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">#&gt; 1: Both    All King County 2016 - 2018                 All   All 0.1411051</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">#&gt;             se numerator denominator  variable</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co">#&gt; 1: 0.005466637      3626       28336 ecig_vape</span></a></code></pre></div>
<p>With this command, we calculated the proportion of all valid HYS respondents in King County who vaped for the years 2016 and 2018. As the print out hopefully shows, this proportion of students is 0.14. Wooo! Go us!</p>
<p>But what if we want to see the vaping proportions by race and stratified by 6th and 8th graders versus 10th and 12th graders? Well, funny you should ask…</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2">res &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="st">  </span><span class="kw">tabulate_variable</span>(<span class="dt">variable =</span> <span class="st">&#39;ecig_vape&#39;</span>,</a>
<a class="sourceLine" id="cb7-4" title="4">                    <span class="dt">metrics =</span> <span class="st">&#39;mean&#39;</span>, <span class="co">#only the mean this time</span></a>
<a class="sourceLine" id="cb7-5" title="5">                    <span class="dt">sex =</span> <span class="st">&#39;both&#39;</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">                    <span class="dt">grade =</span> <span class="kw">list</span>(<span class="dt">Tiny =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">8</span>), <span class="dt">Big =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">12</span>)), <span class="co">#two grade groups</span></a>
<a class="sourceLine" id="cb7-7" title="7">                    <span class="dt">region =</span> <span class="ot">NULL</span>, <span class="co">#all regions</span></a>
<a class="sourceLine" id="cb7-8" title="8">                    <span class="dt">race =</span> <span class="st">&#39;all&#39;</span>, <span class="co">#a_race8,</span></a>
<a class="sourceLine" id="cb7-9" title="9">                    <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2016</span>, <span class="dv">2018</span>), <span class="co">#each year seperately</span></a>
<a class="sourceLine" id="cb7-10" title="10">                    <span class="dt">sexual_orientation =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb7-11" title="11">                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb7-12" title="12">                   )</a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">res =<span class="st"> </span>res[.Race <span class="op">!=</span><span class="st"> &#39;Race: NA&#39;</span>, .(.Race, .Grade, <span class="dt">Percent =</span> <span class="kw">round</span>(mean <span class="op">*</span><span class="st"> </span><span class="dv">100</span>))]</a>
<a class="sourceLine" id="cb7-15" title="15">res[]</a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt;        .Race .Grade Percent</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt;  1:     AIAN    Big      24</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt;  2:    Asian    Big      11</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt;  3:    Black    Big      14</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&gt;  4: Hispanic    Big      18</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&gt;  5: Multiple    Big      19</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&gt;  6:     NHPI    Big      18</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&gt;  7:    Other    Big      17</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co">#&gt;  8:    White    Big      20</span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="co">#&gt;  9:     AIAN   Tiny       9</span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="co">#&gt; 10:    Asian   Tiny       3</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="co">#&gt; 11:    Black   Tiny       7</span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="co">#&gt; 12: Hispanic   Tiny      11</span></a>
<a class="sourceLine" id="cb7-29" title="29"><span class="co">#&gt; 13: Multiple   Tiny       7</span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="co">#&gt; 14:     NHPI   Tiny       9</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="co">#&gt; 15:    Other   Tiny       7</span></a>
<a class="sourceLine" id="cb7-32" title="32"><span class="co">#&gt; 16:    White   Tiny       5</span></a></code></pre></div>
<p>Note how the <code>grade</code> argument is specified and how it relates to the output. We pass a named list of the rough format <code>list(output_name = c(vector, of, inputs), name2= input2)</code> to do on the fly recoding. For this to work properly, you need to know the values in the grade column– in this case, a_grade8. Probably in the future, some of this interface will change as we standardize the names for common demographic categories. Another change from above is that the argument <code>race</code> is now set to <code>&quot;all&quot;</code> rather than <code>NULL</code>. For <code>tabulate_variable</code>, <code>NULL</code> generally works out to mean “skip this column for the purposes for selection and grouping”. Now that <code>race</code> is set to <code>&quot;all&quot;</code> the function works internally to compute metrics by each race, as specified in the <code>a_race8</code> column. Other options include <code>&quot;all-NH&quot;</code> or <code>&quot;aic&quot;</code>. The former seperates all the races into their non-hispanic version while the latter loops over the alone and in combination options specified.</p>
<p>We can compute alone or in combination metrics as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"></a>
<a class="sourceLine" id="cb8-2" title="2">res &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="st">  </span><span class="kw">tabulate_variable</span>(<span class="dt">variable =</span> <span class="st">&#39;ecig_vape&#39;</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">                    <span class="dt">metrics =</span> <span class="st">&#39;mean&#39;</span>, <span class="co">#only the mean this time</span></a>
<a class="sourceLine" id="cb8-5" title="5">                    <span class="dt">sex =</span> <span class="st">&#39;both&#39;</span>,</a>
<a class="sourceLine" id="cb8-6" title="6">                    <span class="dt">grade =</span> <span class="ot">NULL</span>, <span class="co">#two grade groups</span></a>
<a class="sourceLine" id="cb8-7" title="7">                    <span class="dt">region =</span> <span class="ot">NULL</span>, <span class="co">#all regions</span></a>
<a class="sourceLine" id="cb8-8" title="8">                    <span class="dt">race =</span> <span class="st">&#39;aic&#39;</span>, <span class="co">#all alone or in combination groups,</span></a>
<a class="sourceLine" id="cb8-9" title="9">                    <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2016</span>, <span class="dv">2018</span>), <span class="co">#each year seperately</span></a>
<a class="sourceLine" id="cb8-10" title="10">                    <span class="dt">sexual_orientation =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb8-11" title="11">                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb8-12" title="12">                   )</a>
<a class="sourceLine" id="cb8-13" title="13"></a>
<a class="sourceLine" id="cb8-14" title="14">res =<span class="st"> </span>res[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;Not&#39;</span>, .Race, <span class="dt">fixed =</span> T), .(.Race, <span class="dt">Percent =</span> <span class="kw">round</span>(mean <span class="op">*</span><span class="st"> </span><span class="dv">100</span>))]</a>
<a class="sourceLine" id="cb8-15" title="15">res[]</a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co">#&gt;               .Race Percent</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="co">#&gt;  1:           Asian      11</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">#&gt;  2:            AIAN      18</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co">#&gt;  3:           Black      14</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="co">#&gt;  4:        Hispanic      17</span></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="co">#&gt;  5:            NHPI      16</span></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="co">#&gt;  6:           White      16</span></a>
<a class="sourceLine" id="cb8-23" title="23"><span class="co">#&gt;  7:           Other      13</span></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="co">#&gt;  8:    Asian Indian       8</span></a>
<a class="sourceLine" id="cb8-25" title="25"><span class="co">#&gt;  9: Cambodian/Khmer      14</span></a>
<a class="sourceLine" id="cb8-26" title="26"><span class="co">#&gt; 10:         Chinese       8</span></a>
<a class="sourceLine" id="cb8-27" title="27"><span class="co">#&gt; 11:        Filipino      15</span></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="co">#&gt; 12:        Japanese      14</span></a>
<a class="sourceLine" id="cb8-29" title="29"><span class="co">#&gt; 13:          Korean      11</span></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="co">#&gt; 14:      Vietnamese       8</span></a>
<a class="sourceLine" id="cb8-31" title="31"><span class="co">#&gt; 15:   Asian - other      12</span></a></code></pre></div>
<p>But maybe we only care about a few alone or in combination groups for a particular analysis:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"></a>
<a class="sourceLine" id="cb9-2" title="2">res &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span><span class="kw">tabulate_variable</span>(<span class="dt">variable =</span> <span class="st">&#39;ecig_vape&#39;</span>,</a>
<a class="sourceLine" id="cb9-4" title="4">                    <span class="dt">metrics =</span> <span class="st">&#39;mean&#39;</span>, <span class="co">#only the mean this time</span></a>
<a class="sourceLine" id="cb9-5" title="5">                    <span class="dt">sex =</span> <span class="st">&#39;both&#39;</span>,</a>
<a class="sourceLine" id="cb9-6" title="6">                    <span class="dt">grade =</span> <span class="ot">NULL</span>, <span class="co">#two grade groups</span></a>
<a class="sourceLine" id="cb9-7" title="7">                    <span class="dt">region =</span> <span class="ot">NULL</span>, <span class="co">#all regions</span></a>
<a class="sourceLine" id="cb9-8" title="8">                    <span class="dt">race =</span> <span class="kw">c</span>(<span class="st">&#39;a_black_aic&#39;</span>, <span class="st">&#39;a_asian_aic&#39;</span>), <span class="co">#all alone or in combination groups,</span></a>
<a class="sourceLine" id="cb9-9" title="9">                    <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2016</span>, <span class="dv">2018</span>), <span class="co">#each year seperately</span></a>
<a class="sourceLine" id="cb9-10" title="10">                    <span class="dt">sexual_orientation =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb9-11" title="11">                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb9-12" title="12">                   )</a>
<a class="sourceLine" id="cb9-13" title="13"></a>
<a class="sourceLine" id="cb9-14" title="14">res =<span class="st"> </span>res[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;Not&#39;</span>, .Race, <span class="dt">fixed =</span> T), .(.Race, <span class="dt">Percent =</span> <span class="kw">round</span>(mean <span class="op">*</span><span class="st"> </span><span class="dv">100</span>))]</a>
<a class="sourceLine" id="cb9-15" title="15">res[]</a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt;    .Race Percent</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; 1: Black      14</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; 2: Asian      11</span></a></code></pre></div>
<p>Or mayhaps, we want to use a custom grouping (note the inclusion of the <code>race_var</code> argument):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">res &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">  </span><span class="kw">tabulate_variable</span>(<span class="dt">variable =</span> <span class="st">&#39;ecig_vape&#39;</span>,</a>
<a class="sourceLine" id="cb10-3" title="3">                    <span class="dt">metrics =</span> <span class="st">&#39;mean&#39;</span>, <span class="co">#only the mean this time</span></a>
<a class="sourceLine" id="cb10-4" title="4">                    <span class="dt">sex =</span> <span class="st">&#39;both&#39;</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">                    <span class="dt">grade =</span> <span class="ot">NULL</span>, <span class="co">#two grade groups</span></a>
<a class="sourceLine" id="cb10-6" title="6">                    <span class="dt">region =</span> <span class="ot">NULL</span>, <span class="co">#all regions</span></a>
<a class="sourceLine" id="cb10-7" title="7">                    <span class="dt">race =</span> <span class="kw">list</span>(<span class="dt">A =</span> <span class="kw">c</span>(<span class="st">&#39;Asian&#39;</span>, <span class="st">&#39;AIAN&#39;</span>), <span class="dt">H =</span> <span class="st">&#39;Hispanic&#39;</span>), <span class="co">#custom grouping!</span></a>
<a class="sourceLine" id="cb10-8" title="8">                    <span class="dt">race_var =</span> <span class="st">&#39;a_race8&#39;</span>, <span class="co"># this will probably be renamed at some point</span></a>
<a class="sourceLine" id="cb10-9" title="9">                    <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2016</span>, <span class="dv">2018</span>), <span class="co">#each year seperately</span></a>
<a class="sourceLine" id="cb10-10" title="10">                    <span class="dt">sexual_orientation =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb10-11" title="11">                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb10-12" title="12">                   )</a>
<a class="sourceLine" id="cb10-13" title="13"></a>
<a class="sourceLine" id="cb10-14" title="14">res =<span class="st"> </span>res[, .(.Race, <span class="dt">Percent =</span> <span class="kw">round</span>(mean <span class="op">*</span><span class="st"> </span><span class="dv">100</span>))]</a>
<a class="sourceLine" id="cb10-15" title="15">res[]</a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt;    .Race Percent</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; 1:     A       9</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt; 2:     H      16</span></a></code></pre></div>
<p>While most of the arguments to <code>tabulate_variable</code> use the named list format demonstrated above, <code>sex</code> only has two valid options: <code>&quot;both&quot;</code> and “<code>seperate</code>”. What each option does is hopefully not a surprise:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"></a>
<a class="sourceLine" id="cb11-2" title="2">res &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="st">  </span><span class="kw">tabulate_variable</span>(<span class="dt">variable =</span> <span class="st">&#39;ecig_vape&#39;</span>,</a>
<a class="sourceLine" id="cb11-4" title="4">                    <span class="dt">metrics =</span> <span class="st">&#39;mean&#39;</span>, <span class="co">#only the mean this time</span></a>
<a class="sourceLine" id="cb11-5" title="5">                    <span class="dt">sex =</span> <span class="st">&#39;seperate&#39;</span>,</a>
<a class="sourceLine" id="cb11-6" title="6">                    <span class="dt">grade =</span> <span class="ot">NULL</span>, <span class="co">#two grade groups</span></a>
<a class="sourceLine" id="cb11-7" title="7">                    <span class="dt">region =</span> <span class="ot">NULL</span>, <span class="co">#all regions</span></a>
<a class="sourceLine" id="cb11-8" title="8">                    <span class="dt">race =</span> <span class="ot">NULL</span>, <span class="co">#custom grouping! Everything else goes to NA and is dropped</span></a>
<a class="sourceLine" id="cb11-9" title="9">                    <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2016</span>, <span class="dv">2018</span>), <span class="co">#each year seperately</span></a>
<a class="sourceLine" id="cb11-10" title="10">                    <span class="dt">sexual_orientation =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb11-11" title="11">                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb11-12" title="12">                   )</a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14">res =<span class="st"> </span>res[, .(.Sex, <span class="dt">Percent =</span> <span class="kw">round</span>(mean <span class="op">*</span><span class="st"> </span><span class="dv">100</span>))]</a>
<a class="sourceLine" id="cb11-15" title="15">res[]</a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co">#&gt;      .Sex Percent</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co">#&gt; 1: Female      14</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="co">#&gt; 2:   Male      14</span></a></code></pre></div>
<p><code>tabulate_variable</code> is designed to be the interface to most common interface for analyzing HYS data. However, the function is limited in the number of “by” variables it can handle. Another function, <code>survey_tabulate</code> provides a slightly lower level interface for analyzing HYS (and other survey) datasets.</p>
<p>For example, if we wanted to compute the percentage of students who vape by whether they’ve ever had sex, we do something like:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"></a>
<a class="sourceLine" id="cb12-2" title="2">res &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">survey_tabulate</span>(<span class="dt">what =</span> <span class="st">&#39;ecig_vape&#39;</span>,</a>
<a class="sourceLine" id="cb12-3" title="3">                               kingco <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="op">!</span><span class="kw">is.na</span>(ecig_vape), kcfinalwt<span class="op">&gt;</span><span class="dv">0</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">2018</span>,</a>
<a class="sourceLine" id="cb12-4" title="4">                               <span class="dt">by =</span> <span class="st">&#39;ever_sex&#39;</span>,</a>
<a class="sourceLine" id="cb12-5" title="5">                               <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;numerator&#39;</span>, <span class="st">&#39;denominator&#39;</span>),</a>
<a class="sourceLine" id="cb12-6" title="6">                               <span class="dt">proportion =</span> T)</a>
<a class="sourceLine" id="cb12-7" title="7">res[]</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt;    ever_sex       mean numerator denominator  variable</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; 1:        0 0.09711009      1136       12078 ecig_vape</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; 2:        1 0.42101362      1267        2919 ecig_vape</span></a></code></pre></div>
<p>Hooray! Numbers and custom and stuff. Note that internally, rows that are NA for either the <code>what</code> argument or the <code>by</code> argument are filtered out and that the function use <code>...</code> to pass along other filter conditions (e.g. <code>kcfinalwt&gt;0</code>). Does that mean the <code>!is.na(ecig_vape)</code> bit above is redundant? Yes. Yes it does. Does it matter? No. No it doesn’t.</p>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
